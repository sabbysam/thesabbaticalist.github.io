<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The Sabbaticalist</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0d1b2a;
      --accent: #ffb703;
      --accent-dark: #fb8500;
      --card: #10243f;
      --text: #e8f1ff;
      --muted: #9fb3c8;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background: radial-gradient(circle at 20% 20%, rgba(255, 183, 3, 0.2), transparent 35%),
                  radial-gradient(circle at 80% 10%, rgba(132, 94, 194, 0.25), transparent 30%),
                  linear-gradient(135deg, #0b1324 0%, #0c1a2f 50%, #0a1e38 100%);
      color: var(--text);
      line-height: 1.6;
      scroll-behavior: smooth;
    }

    a {
      color: inherit;
    }

    header {
      position: sticky;
      top: 0;
      z-index: 1000;
      backdrop-filter: blur(14px);
      background: rgba(10, 18, 31, 0.7);
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    }

    nav {
      max-width: 1100px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 1.5rem;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      font-weight: 800;
      letter-spacing: -0.5px;
      text-transform: uppercase;
      font-size: 1rem;
    }

    .logo span {
      display: grid;
      place-items: center;
      width: 36px;
      height: 36px;
      border-radius: 10px;
      background: linear-gradient(135deg, var(--accent), var(--accent-dark));
      color: #0d1b2a;
      font-weight: 900;
    }

    .nav-links {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .nav-links a {
      padding: 0.45rem 0.9rem;
      border-radius: 999px;
      text-decoration: none;
      color: var(--muted);
      font-weight: 600;
      transition: color 0.2s ease, background 0.2s ease;
    }

    .nav-links a:hover,
    .nav-links a:focus-visible {
      background: rgba(255, 255, 255, 0.08);
      color: var(--text);
      outline: none;
    }

    .skip-link {
      position: absolute;
      left: -999px;
      top: auto;
      padding: 0.8rem 1rem;
      background: #fff;
      color: #0d1b2a;
      font-weight: 700;
      border-radius: 10px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.25);
      transition: left 0.2s ease;
      z-index: 1001;
    }

    .skip-link:focus {
      left: 1rem;
      top: 1rem;
    }

    .hero {
      max-width: 1100px;
      margin: 3rem auto 2rem;
      padding: 2rem 1.5rem 3.5rem;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 2rem;
      align-items: center;
    }

    .hero-content h1 {
      font-size: clamp(2.5rem, 4vw, 3.5rem);
      line-height: 1.1;
      margin: 0 0 1rem;
      letter-spacing: -1px;
    }

    .hero-content p {
      margin: 0 0 1.5rem;
      color: var(--muted);
      font-size: 1.05rem;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.55rem 0.9rem;
      background: rgba(255, 255, 255, 0.08);
      border-radius: 999px;
      color: var(--text);
      font-weight: 700;
      letter-spacing: -0.1px;
      text-transform: uppercase;
      font-size: 0.8rem;
    }

    .primary-btn,
    .ghost-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.85rem 1.15rem;
      border-radius: 12px;
      font-weight: 700;
      text-decoration: none;
      transition: transform 0.15s ease, box-shadow 0.2s ease, background 0.2s ease, color 0.2s ease;
      border: none;
      cursor: pointer;
    }

    .primary-btn {
      background: linear-gradient(135deg, var(--accent), var(--accent-dark));
      color: #0d1b2a;
      box-shadow: 0 10px 40px rgba(251, 133, 0, 0.35);
    }

    .ghost-btn {
      background: rgba(255, 255, 255, 0.06);
      color: var(--text);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .primary-btn:hover,
    .ghost-btn:hover,
    .primary-btn:focus-visible,
    .ghost-btn:focus-visible {
      transform: translateY(-1px);
      box-shadow: 0 15px 45px rgba(0, 0, 0, 0.35);
      outline: none;
    }

    .hero-visual {
      background: linear-gradient(160deg, rgba(255, 183, 3, 0.15), rgba(132, 94, 194, 0.15));
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 18px;
      padding: 1.5rem;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.35);
    }

    .hero-gallery {
      margin: 0;
    }

    .hero-carousel {
      position: relative;
      width: 100%;
      border-radius: 14px;
      overflow: hidden;
      aspect-ratio: 4 / 3;
      box-shadow: 0 10px 45px rgba(0, 0, 0, 0.35);
      background: rgba(8, 16, 28, 0.8);
    }

    .hero-slide {
      position: absolute;
      inset: 0;
      opacity: 0;
      transform: translateX(12px);
      transition: opacity 0.7s ease-in-out, transform 0.7s ease-in-out;
    }

    .hero-slide.is-active {
      opacity: 1;
      transform: translateX(0);
      z-index: 1;
    }

    .hero-slide img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .hero-caption {
      margin-top: 0.8rem;
      color: var(--muted);
      font-size: 0.95rem;
    }

    .toggle-row {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin: 0.6rem 0 1rem;
    }

    .pill-toggle {
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: rgba(255, 255, 255, 0.06);
      color: var(--text);
      padding: 0.55rem 0.95rem;
      border-radius: 999px;
      font-weight: 700;
      letter-spacing: -0.1px;
      cursor: pointer;
      transition: background 0.2s ease, border-color 0.2s ease, transform 0.15s ease;
    }

    .pill-toggle[aria-pressed="true"] {
      background: rgba(255, 183, 3, 0.16);
      border-color: rgba(255, 183, 3, 0.35);
      color: #ffe6b3;
      transform: translateY(-1px);
    }

    .runway-preview {
      margin-top: 1.25rem;
      padding: 1rem 1.1rem 1.2rem;
      border-radius: 16px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: 0 12px 35px rgba(0, 0, 0, 0.25);
    }

    .runway-preview label {
      display: block;
      font-weight: 700;
      margin-bottom: 0.7rem;
    }

    .runway-controls {
      display: grid;
      gap: 0.65rem;
      align-items: center;
      grid-template-columns: 1fr 100px;
    }

    .runway-controls input[type="range"] {
      width: 100%;
      accent-color: var(--accent);
    }

    .runway-controls input[type="number"] {
      width: 100%;
      padding: 0.65rem 0.75rem;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.18);
      background: rgba(255, 255, 255, 0.05);
      color: var(--text);
      font-weight: 700;
    }

    .runway-result {
      margin: 0.45rem 0 0.65rem;
      color: var(--muted);
    }

    .runway-preview a {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      font-weight: 700;
      text-decoration: none;
      color: var(--text);
    }

    .section {
      max-width: 1100px;
      margin: 0 auto;
      padding: 3.5rem 1.5rem;
    }

    .section h2 {
      margin: 0 0 1rem;
      font-size: clamp(1.8rem, 3vw, 2.4rem);
      letter-spacing: -0.5px;
    }

    .section p {
      margin: 0 0 1.5rem;
      color: var(--muted);
    }

    .cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 1.5rem;
    }

    .card {
      background: var(--card);
      border-radius: 16px;
      padding: 1.5rem;
      border: 1px solid rgba(255, 255, 255, 0.05);
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.35);
      position: relative;
      overflow: hidden;
    }

    .reveal {
      opacity: 0;
      transform: translateY(16px);
      transition: opacity 0.5s ease, transform 0.5s ease;
      will-change: opacity, transform;
    }

    .reveal.is-visible {
      opacity: 1;
      transform: translateY(0);
    }

    .hero-content,
    .hero-visual {
      will-change: transform;
    }

    @media (prefers-reduced-motion: reduce) {
      .hero-slide,
      .reveal {
        transition: none;
      }
    }

    .card::after {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 30% 20%, rgba(255, 183, 3, 0.08), transparent 40%);
      pointer-events: none;
    }

    .card h3 {
      margin: 0 0 0.5rem;
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 1rem;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      background: rgba(255, 255, 255, 0.08);
      padding: 0.4rem 0.75rem;
      border-radius: 999px;
      font-size: 0.9rem;
      margin-top: 0.75rem;
    }

    .tools form {
      display: grid;
      gap: 0.75rem;
      margin-top: 1rem;
    }

    .tools label {
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
      color: var(--muted);
      font-weight: 600;
      letter-spacing: -0.1px;
    }

    .tools input {
      padding: 0.85rem 0.9rem;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.15);
      background: rgba(255, 255, 255, 0.04);
      color: var(--text);
      font-size: 1rem;
    }

    .tools select {
      padding: 0.85rem 0.9rem;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.15);
      background: rgba(255, 255, 255, 0.04);
      color: var(--text);
      font-size: 1rem;
    }

    .tools select[multiple] {
      min-height: 130px;
    }

    .tools input:focus-visible {
      outline: 2px solid var(--accent);
      border-color: transparent;
    }

    .subtle {
      color: var(--muted);
      font-size: 0.95rem;
    }

    .itinerary-output {
      margin-top: 1rem;
      display: flex;
      flex-direction: column;
      gap: 0.9rem;
    }

    .itinerary-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    .itinerary-results {
      display: grid;
      gap: 0.75rem;
    }

    .itinerary-item {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      padding: 0.85rem 1rem;
    }

    .itinerary-item h4 {
      margin: 0 0 0.35rem;
      letter-spacing: -0.1px;
    }

    .itinerary-meta {
      color: var(--muted);
      margin: 0 0 0.3rem;
      font-weight: 600;
    }

    .itinerary-anchors {
      margin: 0.15rem 0 0;
      color: var(--text);
      font-weight: 600;
    }

    footer {
      text-align: center;
      padding: 2rem 1.5rem 3rem;
      color: var(--muted);
      border-top: 1px solid rgba(255, 255, 255, 0.08);
      background: rgba(0, 0, 0, 0.2);
    }

    @media (max-width: 720px) {
      nav {
        gap: 1rem;
      }
      .nav-links {
        justify-content: flex-start;
      }
    }
  </style>
</head>
<body>
  <a href="#main" class="skip-link">Skip to main content</a>
  <header>
    <nav aria-label="Primary">
      <div class="logo"><span>TS</span> The Sabbaticalist</div>
      <div class="nav-links">
        <a href="#toolkit">Toolkit</a>
        <a href="#calculators">Calculators</a>
        <a href="#calendar">Seasons</a>
        <a href="#gear">Gear</a>
        <a href="#plan">Plan</a>
        <a href="#contact">Contact</a>
      </div>
    </nav>
  </header>

  <main id="main">
    <section class="hero">
      <div class="hero-content">
        <div class="badge">Take time off, on purpose</div>
        <h1>Sabbaticals for people who refuse to burn out.</h1>
        <p id="hero-subheadline">Design a career break with clarity, numbers that add up, and places that light you up. No fluff‚Äîjust tools, templates, and coaching to make your year off actually happen.</p>
        <div class="toggle-row" aria-label="Values toggles">
          <button class="pill-toggle tone-toggle" type="button" data-mode="adventure" aria-pressed="false">Adventure</button>
          <button class="pill-toggle tone-toggle" type="button" data-mode="comfort" aria-pressed="true">Comfort</button>
          <button class="pill-toggle tone-toggle" type="button" data-mode="clarity" aria-pressed="false">Clarity</button>
        </div>
        <div style="display:flex;gap:0.75rem;flex-wrap:wrap;">
          <a class="primary-btn" href="https://substack.com/@sbwinston" target="_blank" rel="noopener">Join the newsletter</a>
          <a class="ghost-btn" href="#toolkit">Browse the toolkit</a>
        </div>
        <div class="runway-preview" aria-live="polite">
          <label for="preview-savings">If you had $<span id="preview-inline-savings">50,000</span> saved‚Ä¶</label>
          <div class="runway-controls">
            <input type="range" id="preview-savings" min="5000" max="100000" step="500" value="50000" />
            <input type="number" id="preview-savings-number" min="0" step="500" value="50000" inputmode="decimal" aria-label="Edit savings amount" />
          </div>
          <p class="runway-result">That‚Äôs <strong id="preview-months">~11</strong> months of travel at a $4,500/mo pace.</p>
          <a href="#calculators">See full calculator ‚Üí</a>
        </div>
      </div>
      <div class="hero-visual">
        <figure class="hero-gallery">
          <div class="hero-carousel" aria-live="off">
            <div class="hero-slide is-active" data-caption="Amalfi Coast, Italy">
              <img src="https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?auto=format&fit=crop&w=1200&q=80" alt="Sunlit cliffs over the Amalfi Coast" loading="lazy" />
            </div>
            <div class="hero-slide" data-caption="Banff, Canada">
              <img src="https://images.unsplash.com/photo-1449034446853-66c86144b0ad?auto=format&fit=crop&w=1200&q=80" alt="Turquoise alpine lake in Banff" loading="lazy" />
            </div>
            <div class="hero-slide" data-caption="Kyoto, Japan">
              <img src="https://images.unsplash.com/photo-1469474968028-56623f02e42e?auto=format&fit=crop&w=1200&q=80" alt="Misty bamboo forest in Kyoto" loading="lazy" />
            </div>
            <div class="hero-slide" data-caption="Lisbon, Portugal">
              <img src="https://images.unsplash.com/photo-1491553895911-0055eca6402d?auto=format&fit=crop&w=1200&q=80" alt="Sunset over the rooftops of Lisbon" loading="lazy" />
            </div>
          </div>
          <figcaption class="hero-caption" id="hero-caption">Amalfi Coast, Italy</figcaption>
        </figure>
      </div>
    </section>

    <section class="section reveal" id="toolkit">
      <h2>üõ†Ô∏è The Sabbatical Toolkit</h2>
      <p>Everything I wish I had before my first break: checklists, budgeting frameworks, and ready-to-use planning templates.</p>
      <div class="cards">
        <article class="card reveal">
          <h3>Planning Checklist</h3>
          <p class="subtle">Visa research, notice periods, health, housing, insurance, and the exact sequencing to keep you sane.</p>
          <a class="primary-btn" href="https://drive.google.com" target="_blank" rel="noopener">Download checklist</a>
        </article>
        <article class="card reveal">
          <h3>Budget Template</h3>
          <p class="subtle">Built for year-long travel with real numbers and contingency buffers.</p>
          <a class="ghost-btn" href="#calculators">Estimate costs</a>
        </article>
        <article class="card reveal">
          <h3>Community</h3>
          <p class="subtle">Monthly live Q&A sessions with people planning their own breaks.</p>
          <a class="ghost-btn" href="mailto:sbwinston@gmail.com">Say hi</a>
        </article>
      </div>
    </section>

    <section class="section tools" id="calculators">
      <h2>üí∏ Quick calculators</h2>
      <p>Get a fast read on what your sabbatical might cost and how to travel lighter on the planet.</p>
      <div class="cards">
        <article class="card reveal">
          <h3>Sabbatical budget</h3>
          <form id="budget-form">
            <label>Flights <input type="number" id="budget-flights" min="0" step="0.01" inputmode="decimal" placeholder="1200" /></label>
            <label>Accommodation <input type="number" id="budget-accom" min="0" step="0.01" inputmode="decimal" placeholder="8000" /></label>
            <label>Food & daily spend <input type="number" id="budget-food" min="0" step="0.01" inputmode="decimal" placeholder="5000" /></label>
            <button type="submit" class="primary-btn">Calculate</button>
          </form>
          <p id="budget-result" class="subtle" aria-live="polite"></p>
        </article>
        <article class="card reveal">
          <h3>Carbon estimate</h3>
          <form id="carbon-form">
            <label>Roundtrip miles <input type="number" id="carbon-miles" min="0" step="1" inputmode="numeric" placeholder="9000" /></label>
            <button type="submit" class="primary-btn">Estimate CO‚ÇÇ</button>
          </form>
          <p id="carbon-result" class="subtle" aria-live="polite"></p>
        </article>
        <article class="card reveal">
          <h3>Cost &amp; Runway calculator</h3>
          <form id="runway-form">
            <label>Starting savings <input type="number" id="runway-savings" min="0" step="100" inputmode="decimal" value="20000" required /></label>
            <label>Monthly income (optional) <input type="number" id="runway-income" min="0" step="50" inputmode="decimal" value="0" /></label>
            <label>Travel style
              <select id="runway-style">
                <option value="budget">Budget</option>
                <option value="comfortable" selected>Comfortable</option>
                <option value="nice">Nice</option>
              </select>
            </label>
            <label>Region
              <select id="runway-region">
                <option value="global">Global mix</option>
                <option value="sea">Southeast Asia</option>
                <option value="latam">Latin America</option>
                <option value="europe">Europe</option>
              </select>
            </label>
            <label>Extra monthly home costs <input type="number" id="runway-home" min="0" step="50" inputmode="decimal" value="300" /></label>
            <button type="submit" class="primary-btn">Estimate runway</button>
          </form>
          <p id="runway-result" class="subtle" aria-live="polite"></p>
        </article>
        <article class="card reveal">
          <h3>Itinerary generator</h3>
          <form id="itinerary-form">
            <label>Trip length (months)
              <select id="itinerary-length">
                <option value="3">3</option>
                <option value="6" selected>6</option>
                <option value="9">9</option>
                <option value="12">12</option>
              </select>
            </label>
            <label>Pace
              <select id="itinerary-pace">
                <option value="slow">Slow</option>
                <option value="balanced" selected>Balanced</option>
                <option value="fast">Fast</option>
              </select>
            </label>
            <label>Climate preference
              <select id="itinerary-climate">
                <option value="warm">Warm</option>
                <option value="mixed" selected>Mixed</option>
                <option value="cool">Cool</option>
              </select>
            </label>
            <label>Primary interest
              <select id="itinerary-vibe">
                <option value="nature">Nature</option>
                <option value="cities">Cities</option>
                <option value="mixed" selected>Mixed</option>
              </select>
            </label>
            <label>Budget
              <select id="itinerary-budget">
                <option value="budget">Budget</option>
                <option value="comfortable" selected>Comfortable</option>
                <option value="nice">Nice</option>
              </select>
            </label>
            <label>Season start month
              <select id="itinerary-start-month">
                <option value="1">January</option>
                <option value="2">February</option>
                <option value="3">March</option>
                <option value="4">April</option>
                <option value="5">May</option>
                <option value="6" selected>June</option>
                <option value="7">July</option>
                <option value="8">August</option>
                <option value="9">September</option>
                <option value="10">October</option>
                <option value="11">November</option>
                <option value="12">December</option>
              </select>
            </label>
            <label>Avoid (multi-select)
              <select id="itinerary-avoid" multiple>
                <option value="avoid-long-flights">Avoid long flights</option>
                <option value="avoid-winter">Avoid winter</option>
                <option value="avoid-expensive">Avoid expensive regions</option>
              </select>
            </label>
            <button type="submit" class="primary-btn">Generate itinerary</button>
          </form>
          <div class="itinerary-output">
            <div class="itinerary-header">
              <p id="itinerary-summary" class="subtle" aria-live="polite">Set your inputs and generate a starter route.</p>
              <button type="button" id="copy-itinerary" class="ghost-btn" disabled>Copy itinerary</button>
            </div>
            <div id="itinerary-results" class="itinerary-results" aria-live="polite"></div>
          </div>
        </article>
      </div>
    </section>

    <section class="section reveal" id="plan">
      <h2>üìä Explore a real sabbatical plan</h2>
      <p>Steal the template I use with coaching clients‚Äîdates, flights, costs, and a pace that avoids burnout.</p>
      <a class="primary-btn" href="Final_365-Day_Sabbatical__Max_30_Days_Rule___Flight_Costs_.csv" download>Download the CSV</a>
    </section>

    <section class="section reveal" id="calendar">
      <h2>üìÖ Where to go, month by month</h2>
      <p>Built for weather, crowds, and vibe. Swap months as your preferences demand.</p>
      <div class="calendar-grid">
        <div class="card reveal"><h3>January</h3><p class="subtle">New Zealand ‚Äî alpine summer trails.</p></div>
        <div class="card reveal"><h3>February</h3><p class="subtle">Thailand ‚Äî dry season islands.</p></div>
        <div class="card reveal"><h3>March</h3><p class="subtle">Japan ‚Äî slow hanami in Kyoto.</p></div>
        <div class="card reveal"><h3>April</h3><p class="subtle">Portugal ‚Äî shoulder season sun.</p></div>
        <div class="card reveal"><h3>May</h3><p class="subtle">Peru ‚Äî trekking without the crowds.</p></div>
        <div class="card reveal"><h3>June</h3><p class="subtle">Albania ‚Äî Adriatic beaches minus the price tag.</p></div>
        <div class="card reveal"><h3>July</h3><p class="subtle">Georgia ‚Äî mountain air and wine country.</p></div>
        <div class="card reveal"><h3>August</h3><p class="subtle">Indonesia ‚Äî surf & slow villages.</p></div>
        <div class="card reveal"><h3>September</h3><p class="subtle">Italy ‚Äî Apennine hikes + empty museums.</p></div>
        <div class="card reveal"><h3>October</h3><p class="subtle">Chile ‚Äî Patagonian spring.</p></div>
        <div class="card reveal"><h3>November</h3><p class="subtle">Vietnam ‚Äî cool northern treks.</p></div>
        <div class="card reveal"><h3>December</h3><p class="subtle">Argentina ‚Äî warm city nights.</p></div>
      </div>
    </section>

    <section class="section reveal" id="gear">
      <h2>üéí Travel gear I actually use</h2>
      <p>Curated essentials built for long-term travel. Swap in your own affiliate links when you‚Äôre ready.</p>
      <div class="cards">
        <article class="card reveal">
          <h3>Nomatic Travel Pack</h3>
          <p class="subtle">One-bag setup with compression cubes.</p>
          <a class="primary-btn" href="https://www.amazon.com/s?k=Nomatic+Travel+Pack" target="_blank" rel="noopener">View on Amazon</a>
        </article>
        <article class="card reveal">
          <h3>Universal adapter</h3>
          <p class="subtle">Two USB-C ports plus surge protection.</p>
          <a class="primary-btn" href="https://www.amazon.com/s?k=universal+travel+adapter+usb+c" target="_blank" rel="noopener">View on Amazon</a>
        </article>
        <article class="card reveal">
          <h3>Noise cancelling headphones</h3>
          <p class="subtle">To survive overnight buses and open offices.</p>
          <a class="primary-btn" href="https://www.amazon.com/s?k=noise+cancelling+headphones+travel" target="_blank" rel="noopener">View on Amazon</a>
        </article>
        <article class="card reveal">
          <h3>Kindle Paperwhite</h3>
          <p class="subtle">4,000 books, zero extra kilos.</p>
          <a class="primary-btn" href="https://www.amazon.com/s?k=kindle+paperwhite" target="_blank" rel="noopener">View on Amazon</a>
        </article>
      </div>
      <p class="subtle" style="margin-top:1rem;">These are placeholder links‚Äîreplace them with your own once your affiliate program is approved.</p>
    </section>

    <section class="section reveal" id="contact">
      <h2>üß≠ Want a sanity check?</h2>
      <p>Send me your rough plan. I‚Äôll tell you if it‚Äôs realistic, where to slow down, and how to keep your savings intact.</p>
      <div style="display:flex;gap:0.75rem;flex-wrap:wrap;align-items:center;">
        <a class="primary-btn" href="mailto:sbwinston@gmail.com">Email sbwinston@gmail.com</a>
        <span class="pill">24h response for subscribers</span>
      </div>
    </section>
  </main>

  <footer>
    <p>¬© 2025 The Sabbaticalist. Built for people who care about work and rest.</p>
  </footer>

  <script>
    const tonePresets = {
      adventure: {
        sub: 'Places that stretch you. Swap routine for range: treks, new skills, and friends you haven‚Äôt met yet.',
      },
      comfort: {
        sub: 'Places that restore you. Soft landings, slower mornings, and meals that feel like home.',
      },
      clarity: {
        sub: 'Plans you can trust. Visas sorted, budgets clear, and a pace that lets you think again.',
      },
    };

    const toggleButtons = document.querySelectorAll('.tone-toggle');
    const heroSubheadline = document.getElementById('hero-subheadline');

    const setTone = (mode) => {
      const tone = tonePresets[mode] || tonePresets.comfort;
      heroSubheadline.textContent = tone.sub;
      toggleButtons.forEach((btn) => {
        const isActive = btn.dataset.mode === mode;
        btn.setAttribute('aria-pressed', isActive ? 'true' : 'false');
      });
    };

    toggleButtons.forEach((btn) =>
      btn.addEventListener('click', () => {
        setTone(btn.dataset.mode);
      })
    );

    const heroCaption = document.getElementById('hero-caption');
    const heroSlides = Array.from(document.querySelectorAll('.hero-slide'));
    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    let heroSlideIndex = 0;

    const updateHeroCaption = (slide) => {
      const caption = slide?.dataset?.caption;
      if (caption && heroCaption) {
        heroCaption.textContent = caption;
      }
    };

    const setActiveHeroSlide = (index) => {
      heroSlides.forEach((slide, idx) => {
        slide.classList.toggle('is-active', idx === index);
      });
      updateHeroCaption(heroSlides[index]);
    };

    const advanceHeroSlide = () => {
      if (heroSlides.length <= 1) return;
      heroSlideIndex = (heroSlideIndex + 1) % heroSlides.length;
      setActiveHeroSlide(heroSlideIndex);
    };

    if (heroSlides.length) {
      setActiveHeroSlide(heroSlideIndex);
      if (!prefersReducedMotion) {
        setInterval(advanceHeroSlide, 5200);
      }
    }

    const heroContent = document.querySelector('.hero-content');
    const heroVisual = document.querySelector('.hero-visual');
    let parallaxFrame = null;

    const updateHeroParallax = () => {
      const scrollY = window.scrollY || window.pageYOffset;
      const contentOffset = Math.min(scrollY * 0.12, 60);
      const visualOffset = Math.min(scrollY * 0.08, 50);
      if (heroContent) {
        heroContent.style.transform = `translateY(${contentOffset}px)`;
      }
      if (heroVisual) {
        heroVisual.style.transform = `translateY(${visualOffset}px)`;
      }
      parallaxFrame = null;
    };

    const handleParallaxScroll = () => {
      if (parallaxFrame !== null) return;
      parallaxFrame = window.requestAnimationFrame(updateHeroParallax);
    };

    window.addEventListener('scroll', handleParallaxScroll, { passive: true });
    updateHeroParallax();

    const revealElements = document.querySelectorAll('.reveal');
    if ('IntersectionObserver' in window) {
      const revealObserver = new IntersectionObserver(
        (entries, observer) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              entry.target.classList.add('is-visible');
              observer.unobserve(entry.target);
            }
          });
        },
        { threshold: 0.18 }
      );

      revealElements.forEach((element) => revealObserver.observe(element));
    } else {
      revealElements.forEach((element) => element.classList.add('is-visible'));
    }

    const savingsSlider = document.getElementById('preview-savings');
    const savingsNumber = document.getElementById('preview-savings-number');
    const inlineSavings = document.getElementById('preview-inline-savings');
    const previewMonths = document.getElementById('preview-months');
    const monthlyPace = 4500;

    const formatCurrency = (value) => Number(value).toLocaleString('en-US', { maximumFractionDigits: 0 });

    const updateRunwayPreview = (value) => {
      const cleanValue = Math.max(0, Number(value) || 0);
      const maxValue = Number(savingsSlider?.max) || cleanValue;
      const boundedValue = Math.min(cleanValue, maxValue);
      const months = boundedValue / monthlyPace;
      inlineSavings.textContent = formatCurrency(boundedValue);
      previewMonths.textContent = `~${months.toFixed(1)}`;
      savingsSlider.value = boundedValue;
      savingsNumber.value = boundedValue;
    };

    savingsSlider?.addEventListener('input', (event) => {
      updateRunwayPreview(event.target.value);
    });

    savingsNumber?.addEventListener('input', (event) => {
      updateRunwayPreview(event.target.value);
    });

    setTone('comfort');
    updateRunwayPreview(savingsSlider?.value || 50000);

    const budgetForm = document.getElementById('budget-form');
    const budgetResult = document.getElementById('budget-result');
    budgetForm?.addEventListener('submit', (event) => {
      event.preventDefault();
      const flights = parseFloat(document.getElementById('budget-flights').value) || 0;
      const accom = parseFloat(document.getElementById('budget-accom').value) || 0;
      const food = parseFloat(document.getElementById('budget-food').value) || 0;
      const total = flights + accom + food;
      budgetResult.textContent = `Estimated total: $${total.toFixed(2)}`;
    });

    const carbonForm = document.getElementById('carbon-form');
    const carbonResult = document.getElementById('carbon-result');
    carbonForm?.addEventListener('submit', (event) => {
      event.preventDefault();
      const miles = parseFloat(document.getElementById('carbon-miles').value) || 0;
      const tons = (miles * 0.0002).toFixed(2);
      carbonResult.textContent = `Estimated CO‚ÇÇ: ${tons} metric tons. Consider offsetting through a verified project.`;
    });

    const runwayForm = document.getElementById('runway-form');
    const runwayResult = document.getElementById('runway-result');
    const baseByRegion = {
      global: 2200,
      sea: 1500,
      latam: 1700,
      europe: 2600,
    };
    const styleMultiplier = {
      budget: 0.85,
      comfortable: 1,
      nice: 1.2,
    };

    runwayForm?.addEventListener('submit', (event) => {
      event.preventDefault();

      const savingsInput = parseFloat(document.getElementById('runway-savings').value);
      if (Number.isNaN(savingsInput) || savingsInput <= 0) {
        runwayResult.textContent = 'Enter your starting savings (more than $0).';
        return;
      }

      const incomeInput = parseFloat(document.getElementById('runway-income').value);
      const monthlyIncome = Number.isNaN(incomeInput) ? 0 : Math.max(incomeInput, 0);
      const style = document.getElementById('runway-style').value;
      const region = document.getElementById('runway-region').value;
      const homeInput = parseFloat(document.getElementById('runway-home').value);
      const homeCosts = Number.isNaN(homeInput) ? 0 : Math.max(homeInput, 0);

      const baseMonthly = (baseByRegion[region] || baseByRegion.global) * (styleMultiplier[style] || 1);
      const monthlyBurn = baseMonthly + homeCosts - monthlyIncome;

      if (monthlyBurn <= 0) {
        runwayResult.textContent = 'Estimated monthly net burn: $0. Your income covers projected costs‚Äîyour savings last indefinitely at this pace.';
        return;
      }

      const runwayMonths = savingsInput / monthlyBurn;
      runwayResult.textContent = `Estimated monthly net burn: $${monthlyBurn.toFixed(0)}. Runway: ${runwayMonths.toFixed(1)} months based on your inputs.`;
    });

    const itineraryForm = document.getElementById('itinerary-form');
    const itineraryResults = document.getElementById('itinerary-results');
    const itinerarySummary = document.getElementById('itinerary-summary');
    const copyItineraryButton = document.getElementById('copy-itinerary');
    const itineraryAvoid = document.getElementById('itinerary-avoid');
    const itineraryStartMonth = document.getElementById('itinerary-start-month');

    const monthNames = [
      'January',
      'February',
      'March',
      'April',
      'May',
      'June',
      'July',
      'August',
      'September',
      'October',
      'November',
      'December',
    ];

    const itineraryDestinations = [
      {
        name: 'Northern Thailand',
        region: 'Southeast Asia',
        location: 'Thailand (north)',
        climate: 'warm',
        vibe: 'mixed',
        budget: 'budget',
        flightLength: 'long',
        bestMonths: [11, 12, 1, 2, 3],
        anchors: ['Chiang Mai', 'Pai', 'Chiang Rai'],
        reason: 'Dry season mountains, cafes to work from, and easy visas at low cost.',
      },
      {
        name: 'Vietnam Coast',
        region: 'Southeast Asia',
        location: 'Vietnam',
        climate: 'warm',
        vibe: 'mixed',
        budget: 'budget',
        flightLength: 'long',
        bestMonths: [1, 2, 3, 11, 12],
        anchors: ['Da Nang', 'Hoi An', 'Hue'],
        reason: 'Beach-to-city mix with train links, great food, and shoulder-season prices.',
      },
      {
        name: 'Mexico City & Oaxaca',
        region: 'Latin America',
        location: 'Mexico',
        climate: 'mixed',
        vibe: 'cities',
        budget: 'comfortable',
        flightLength: 'medium',
        bestMonths: [1, 2, 3, 4, 11, 12],
        anchors: ['Mexico City', 'Oaxaca', 'Puebla'],
        reason: 'Culture-forward cities with mild weather and nonstop flights from the U.S.',
      },
      {
        name: 'Patagonia & Lakes',
        region: 'South America',
        location: 'Chile & Argentina',
        climate: 'cool',
        vibe: 'nature',
        budget: 'nice',
        flightLength: 'long',
        bestMonths: [11, 12, 1, 2, 3],
        anchors: ['Puerto Natales', 'Bariloche', 'El Chalt√©n'],
        reason: 'Peak hiking weather with long daylight and bucket-list trails.',
      },
      {
        name: 'Portugal Coast',
        region: 'Europe',
        location: 'Portugal',
        climate: 'mixed',
        vibe: 'cities',
        budget: 'comfortable',
        flightLength: 'medium',
        bestMonths: [4, 5, 6, 9, 10],
        anchors: ['Lisbon', 'Porto', 'Lagos'],
        reason: 'Shoulder-season sun, easy trains, and walkable neighborhoods.',
      },
      {
        name: 'Balkans Loop',
        region: 'Europe',
        location: 'Croatia & Slovenia',
        climate: 'mixed',
        vibe: 'mixed',
        budget: 'comfortable',
        flightLength: 'medium',
        bestMonths: [5, 6, 7, 8, 9],
        anchors: ['Split', 'Dubrovnik', 'Ljubljana'],
        reason: 'Adriatic swims plus alpine escapes, all within easy bus and ferry hops.',
      },
      {
        name: 'Japan Honshu',
        region: 'Asia',
        location: 'Japan',
        climate: 'mixed',
        vibe: 'cities',
        budget: 'nice',
        flightLength: 'long',
        bestMonths: [3, 4, 5, 10, 11],
        anchors: ['Tokyo', 'Kyoto', 'Osaka'],
        reason: 'Reliable trains, food pilgrimages, and mild seasons for long city days.',
      },
      {
        name: 'Peruvian Andes',
        region: 'South America',
        location: 'Peru',
        climate: 'cool',
        vibe: 'nature',
        budget: 'budget',
        flightLength: 'long',
        bestMonths: [5, 6, 7, 8, 9],
        anchors: ['Cusco', 'Sacred Valley', 'Arequipa'],
        reason: 'Dry season treks, high-altitude towns, and solid value for longer stays.',
      },
      {
        name: 'South Africa Cape',
        region: 'Africa',
        location: 'South Africa',
        climate: 'mixed',
        vibe: 'mixed',
        budget: 'comfortable',
        flightLength: 'long',
        bestMonths: [11, 12, 1, 2, 3],
        anchors: ['Cape Town', 'Stellenbosch', 'Hermanus'],
        reason: 'Summer in the southern hemisphere with coastlines, wine country, and hikes.',
      },
      {
        name: 'Bali & Islands',
        region: 'Southeast Asia',
        location: 'Indonesia',
        climate: 'warm',
        vibe: 'nature',
        budget: 'comfortable',
        flightLength: 'long',
        bestMonths: [5, 6, 7, 8, 9],
        anchors: ['Ubud', 'Canggu', 'Uluwatu'],
        reason: 'Dry season surf, wellness hubs, and easy month-long villa rentals.',
      },
      {
        name: 'Spain + Morocco',
        region: 'Europe & Africa',
        location: 'Spain & Morocco',
        climate: 'mixed',
        vibe: 'mixed',
        budget: 'comfortable',
        flightLength: 'medium',
        bestMonths: [3, 4, 5, 10, 11],
        anchors: ['Seville', 'Valencia', 'Marrakesh'],
        reason: 'Rail-linked cities with quick hops to North Africa for contrast.',
      },
      {
        name: 'Australian East Coast',
        region: 'Oceania',
        location: 'Australia',
        climate: 'warm',
        vibe: 'mixed',
        budget: 'nice',
        flightLength: 'long',
        bestMonths: [12, 1, 2, 3],
        anchors: ['Sydney', 'Byron Bay', 'Melbourne'],
        reason: 'Southern summer beaches plus big-city culture and easy domestic flights.',
      },
      {
        name: 'Canadian Rockies',
        region: 'North America',
        location: 'Canada',
        climate: 'cool',
        vibe: 'nature',
        budget: 'nice',
        flightLength: 'medium',
        bestMonths: [6, 7, 8, 9],
        anchors: ['Banff', 'Canmore', 'Vancouver'],
        reason: 'Long-trail hiking, alpine lakes, and crisp weather for outdoor time.',
      },
      {
        name: 'Scandinavia Summer',
        region: 'Europe',
        location: 'Norway & Sweden',
        climate: 'cool',
        vibe: 'nature',
        budget: 'nice',
        flightLength: 'long',
        bestMonths: [6, 7, 8],
        anchors: ['Oslo', 'Bergen', 'Stockholm'],
        reason: 'Midnight sun, fjord ferries, and immaculate hiking infrastructure.',
      },
    ];

    const budgetRank = ['budget', 'comfortable', 'nice'];

    const defaultItineraryState = {
      length: 6,
      pace: 'balanced',
      climate: 'mixed',
      vibe: 'mixed',
      budget: 'comfortable',
      avoid: [],
      startMonth: 6,
    };

    const normalizeMonth = (rawMonth) => {
      const numeric = Number(rawMonth);
      if (Number.isNaN(numeric)) return defaultItineraryState.startMonth;
      const remainder = ((numeric - 1) % 12 + 12) % 12;
      return remainder + 1;
    };

    const wrapMonth = (start, offset = 0) => normalizeMonth(start + offset);

    const isWinterMonth = (month) => [12, 1, 2].includes(month);

    const scoreDestination = (destination, preferences, targetMonth, usedNames) => {
      let score = 0;

      const avoidSet = new Set(preferences.avoid || []);

      if (avoidSet.has('avoid-long-flights')) {
        if (destination.flightLength === 'long') {
          score -= 4;
        } else if (destination.flightLength === 'medium') {
          score -= 1;
        }
      }

      if (avoidSet.has('avoid-expensive')) {
        if (destination.budget === 'nice') {
          score -= 4;
        } else if (destination.budget === 'comfortable') {
          score -= 1;
        }
      }

      if (avoidSet.has('avoid-winter') && isWinterMonth(targetMonth)) {
        if (destination.climate === 'cool') {
          score -= 4;
        } else {
          score -= 1;
        }
      }

      if (destination.climate === preferences.climate) {
        score += 5;
      } else if (destination.climate === 'mixed' || preferences.climate === 'mixed') {
        score += 3;
      } else {
        score += 1;
      }

      if (destination.vibe === preferences.vibe) {
        score += 5;
      } else if (destination.vibe === 'mixed' || preferences.vibe === 'mixed') {
        score += 3;
      } else {
        score += 1;
      }

      const destBudgetIndex = budgetRank.indexOf(destination.budget);
      const prefBudgetIndex = budgetRank.indexOf(preferences.budget);
      const budgetGap = Math.abs(destBudgetIndex - prefBudgetIndex);
      score += Math.max(0, 4 - budgetGap * 2);

      const monthDistance = destination.bestMonths.reduce((closest, month) => {
        const forwardDiff = Math.abs(month - targetMonth);
        const wrappedDiff = Math.min(forwardDiff, 12 - forwardDiff);
        return Math.min(closest, wrappedDiff);
      }, 12);

      if (destination.bestMonths.includes(targetMonth)) {
        score += 6;
      } else if (monthDistance <= 1) {
        score += 3;
      } else if (monthDistance <= 2) {
        score += 1;
      } else {
        score -= 4;
      }

      if (usedNames.has(destination.name)) {
        score -= 3;
      }

      return score;
    };

    const selectDestination = (targetMonth, preferences, usedNames) => {
      const ranked = itineraryDestinations
        .map((destination) => ({
          destination,
          score: scoreDestination(destination, preferences, targetMonth, usedNames),
        }))
        .sort((a, b) => {
          if (b.score === a.score) {
            return a.destination.name.localeCompare(b.destination.name);
          }
          return b.score - a.score;
        });

      const topChoice = ranked[0]?.destination;
      return topChoice || itineraryDestinations[0];
    };

    const calculateStops = (length, pace) => {
      const months = Math.max(1, length);
      const stopMap = {
        slow: Math.max(1, Math.round(months / 3)),
        balanced: Math.max(1, Math.round(months / 2)),
        fast: Math.max(1, months),
      };

      const desiredStops = stopMap[pace] ?? stopMap.balanced;
      return Math.min(desiredStops, itineraryDestinations.length);
    };

    const buildItinerary = (length, pace, preferences) => {
      const totalMonths = Math.min(Math.max(length, 1), 12);
      const stops = calculateStops(totalMonths, pace);
      const monthsPerStop = Math.ceil(totalMonths / stops);
      const used = new Set();
      const stopPlans = [];

      for (let index = 0; index < stops; index += 1) {
        const targetMonth = wrapMonth(preferences.startMonth, index * monthsPerStop);
        const choice = selectDestination(targetMonth, preferences, used);
        stopPlans.push(choice);
        used.add(choice.name);
      }

      const itinerary = [];
      for (let month = 1; month <= totalMonths; month += 1) {
        const stopIndex = Math.min(Math.floor((month - 1) / monthsPerStop), stopPlans.length - 1);
        const stop = stopPlans[stopIndex] || stopPlans[0];
        const calendarMonth = wrapMonth(preferences.startMonth, month - 1);
        itinerary.push({ month, calendarMonth, stop });
      }

      return { itinerary, stops };
    };

    const renderItinerary = (items, summaryLine) => {
      itinerarySummary.textContent = summaryLine;
      if (!items.length) {
        itineraryResults.innerHTML = '<p class="subtle">Set your inputs and generate a starter route.</p>';
        copyItineraryButton.disabled = true;
        return '';
      }

      const content = items
        .map(({ month, calendarMonth, stop }) => {
          const monthLabel = monthNames[calendarMonth - 1] || `Month ${calendarMonth}`;
          return `
            <div class="itinerary-item">
              <h4>Month ${month} (${monthLabel}): ${stop.location}</h4>
              <p class="itinerary-meta">${stop.region} ‚Äî ${stop.name}</p>
              <p class="subtle">Why this fits: ${stop.reason}</p>
              <p class="itinerary-anchors">Anchor cities: ${stop.anchors.join(', ')}</p>
            </div>
          `;
        })
        .join('');

      itineraryResults.innerHTML = content;
      copyItineraryButton.disabled = false;

      const copyBlock = items
        .map(({ month, calendarMonth, stop }) => {
          const monthLabel = monthNames[calendarMonth - 1] || `Month ${calendarMonth}`;
          return `Month ${month} (${monthLabel}): ${stop.location} ‚Äî ${stop.region} / ${stop.name}. Why: ${stop.reason}. Anchors: ${stop.anchors.join(', ')}`;
        })
        .join('\n');

      return `${summaryLine}\n${copyBlock}`;
    };

    const getItineraryStateFromForm = () => {
      const avoidValues = Array.from(itineraryAvoid?.selectedOptions || []).map((option) => option.value);

      return {
        length: parseInt(document.getElementById('itinerary-length')?.value, 10),
        pace: document.getElementById('itinerary-pace')?.value || defaultItineraryState.pace,
        climate: document.getElementById('itinerary-climate')?.value || defaultItineraryState.climate,
        vibe: document.getElementById('itinerary-vibe')?.value || defaultItineraryState.vibe,
        budget: document.getElementById('itinerary-budget')?.value || defaultItineraryState.budget,
        avoid: avoidValues,
        startMonth: normalizeMonth(itineraryStartMonth?.value || defaultItineraryState.startMonth),
      };
    };

    const applyStateToForm = (state) => {
      if (document.getElementById('itinerary-length')) {
        document.getElementById('itinerary-length').value = String(state.length ?? defaultItineraryState.length);
      }
      if (document.getElementById('itinerary-pace')) {
        document.getElementById('itinerary-pace').value = state.pace ?? defaultItineraryState.pace;
      }
      if (document.getElementById('itinerary-climate')) {
        document.getElementById('itinerary-climate').value = state.climate ?? defaultItineraryState.climate;
      }
      if (document.getElementById('itinerary-vibe')) {
        document.getElementById('itinerary-vibe').value = state.vibe ?? defaultItineraryState.vibe;
      }
      if (document.getElementById('itinerary-budget')) {
        document.getElementById('itinerary-budget').value = state.budget ?? defaultItineraryState.budget;
      }
      if (itineraryStartMonth) {
        itineraryStartMonth.value = String(state.startMonth ?? defaultItineraryState.startMonth);
      }
      if (itineraryAvoid) {
        const selected = new Set(state.avoid || []);
        Array.from(itineraryAvoid.options).forEach((option) => {
          option.selected = selected.has(option.value);
        });
      }
    };

    const stateToQuery = (state) => {
      const params = new URLSearchParams();
      params.set('length', state.length ?? defaultItineraryState.length);
      params.set('pace', state.pace ?? defaultItineraryState.pace);
      params.set('climate', state.climate ?? defaultItineraryState.climate);
      params.set('vibe', state.vibe ?? defaultItineraryState.vibe);
      params.set('budget', state.budget ?? defaultItineraryState.budget);
      params.set('startMonth', state.startMonth ?? defaultItineraryState.startMonth);
      if (state.avoid?.length) {
        params.set('avoid', state.avoid.join(','));
      }
      return `?${params.toString()}`;
    };

    const queryToState = () => {
      const params = new URLSearchParams(window.location.search);

      const avoidParam = params.get('avoid');
      const avoid = avoidParam ? avoidParam.split(',').filter(Boolean) : [];

      return {
        length: parseInt(params.get('length') || '', 10) || defaultItineraryState.length,
        pace: params.get('pace') || defaultItineraryState.pace,
        climate: params.get('climate') || defaultItineraryState.climate,
        vibe: params.get('vibe') || defaultItineraryState.vibe,
        budget: params.get('budget') || defaultItineraryState.budget,
        avoid,
        startMonth: normalizeMonth(params.get('startMonth') || defaultItineraryState.startMonth),
      };
    };

    const updateUrlFromState = (state) => {
      const query = stateToQuery(state);
      const newUrl = `${window.location.pathname}${query}${window.location.hash}`;
      window.history.replaceState({}, '', newUrl);
    };

    const generateItinerary = (state, options = { skipUrlUpdate: false }) => {
      const validLengths = [3, 6, 9, 12];
      const tripLength = validLengths.includes(state.length) ? state.length : defaultItineraryState.length;

      const preferences = {
        climate: state.climate,
        vibe: state.vibe,
        budget: state.budget,
        avoid: state.avoid,
        startMonth: state.startMonth,
      };

      const { itinerary, stops } = buildItinerary(tripLength, state.pace, preferences);
      const flights = Math.max(0, stops - 1);
      const summaryLine = `${stops} stops, ~${flights} flight hops starting in ${monthNames[state.startMonth - 1] || 'Month'}. Use this as a planning starting point and adjust for visas + rhythm.`;

      latestItineraryText = renderItinerary(itinerary, summaryLine);

      if (!options.skipUrlUpdate) {
        updateUrlFromState({ ...state, length: tripLength });
      }
    };

    let latestItineraryText = '';

    itineraryForm?.addEventListener('submit', (event) => {
      event.preventDefault();

      const formState = getItineraryStateFromForm();
      generateItinerary(formState);
    });

    const initialState = queryToState();
    applyStateToForm(initialState);
    generateItinerary(initialState, { skipUrlUpdate: true });

    copyItineraryButton?.addEventListener('click', async () => {
      if (!latestItineraryText) return;

      try {
        await navigator.clipboard.writeText(latestItineraryText);
        copyItineraryButton.textContent = 'Copied!';
        setTimeout(() => {
          copyItineraryButton.textContent = 'Copy itinerary';
        }, 1500);
      } catch (error) {
        copyItineraryButton.textContent = 'Copy failed';
        setTimeout(() => {
          copyItineraryButton.textContent = 'Copy itinerary';
        }, 1500);
      }
    });
  </script>
</body>
</html>
